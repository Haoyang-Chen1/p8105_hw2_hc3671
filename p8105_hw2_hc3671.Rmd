---
title: "p8105_hw2_hc3671"
author: "Barry"
date: "2025-09-23"
output: github_document
---

## Problem 1

include packages that will be used:

```{r message=FALSE}
library(tidyverse)
library(dplyr)
library(readxl)
library(stringr)
library(readr)
library(tidyr)
```

import and manipulate data.

```{r message = FALSE}

pol_df = 
  read_csv("data/pols-month.csv") |> 
  separate(mon, into = c("year", "month", "day"), sep = "-") |> 
  mutate(
    year = as.integer(year),
    month = as.integer(month),   # originally as character
    month = month.name[month],
    president = ifelse(prez_gop == 1, "gop", "dem")
  ) |> 
  select(year, month, president, everything(), -c(day, prez_gop, prez_dem), )

snp_df = 
  read_csv("data/snp.csv") |> 
  separate(date, into = c("month", "day", "year"), sep = "/") |> 
  mutate(
    year = as.integer(paste0("20", year)),
    month = as.integer(month),
    month = month.name[month],
  ) |> 
  select(year, month, everything(), -day) |> 
  arrange(year, month)

unemploy_df = 
  read_csv("data/unemployment.csv") |>
  pivot_longer(
      Jan:Dec,
      names_to = "month",
      values_to = "unemp_per"
  ) |> 
  janitor::clean_names() |> 
  mutate(
    year = as.integer(year),
    month = month.name[match(month, month.abb)]
  )

joint_df = 
  left_join(pol_df, snp_df, by = c("year", "month")) |> 
  left_join(unemploy_df, by = c("year", "month"))
```

Description of the data sets above:\
The `pol_df dataset` contains information about the politicians of the two parties in the USA, which includes the identity of the party and the number of different politicians in both parties.The data span from 1947 to 2015, with monthly observations.\
The `snp_df dataset` shows the Standard & Poorâ€™s stock market index monthly from 2000 to 2099(including prediction).\
The `unemploy_df dataset` reports the monthly unemployment rate in the United States. The data cover the period from 1948 to 2015. At first, the value is presented in months. I reshaped them to make sure the format is compatible with other datasets. The joint_df dataset is the combination of the three dataset above, which obeys the date information of the pol_df dataset. Some important values includes:`yeas`,`month`,`president`,`close rate`, and`umployment rate`.\

## Problem 2

```{r}
Mr_trash_wheel = 
  read_excel("data/202409 Trash Wheel Collection Data.xlsx", sheet = "Mr. Trash Wheel", range = "A2:N653") |> 
  janitor::clean_names() |> 
  mutate(
    sports_balls = as.integer(round(sports_balls)),
    type = "Mr. Trash Wheel"
   ) |> 
  select(date, everything(), -c(dumpster, month, year))

Professor_trash_wheel = 
  read_excel("data/202409 Trash Wheel Collection Data.xlsx", sheet = "Professor Trash Wheel", range = "A2:M120") |> 
  janitor::clean_names() |> 
  mutate(
    type = "Professor Trash Wheel"
   ) |> 
  select(date, everything(), -c(dumpster, month, year))

Gwynnda_trash_wheel = 
  read_excel("data/202409 Trash Wheel Collection Data.xlsx", sheet = "Gwynnda Trash Wheel", range = "A2:L265") |> 
  janitor::clean_names() |> 
  mutate(
    type = "Gwynnda Trash Wheel"
   ) |> 
  select(date, everything(), -c(dumpster, month, year))
  
trash_wheel = 
  bind_rows(Mr_trash_wheel, Professor_trash_wheel, Gwynnda_trash_wheel) |> 
  select(date, type, everything()) |> 
  arrange(date)

```

The final dataset has `r nrow(trash_wheel)` observations, including three trash wheels:Mr. Trash Wheel, Professor Trash Wheel, Gwynnda Trash Wheel. Some key values are dumpster identifier `type`, date `date` and the measure of different kinds of trash like `weight_tons`, `volume_cubic_yards`, `plastic_bottles`, `polystyrene`, and `cigarette_butts`.\
More specifically, the total weight of trash collected by Professor Trash Wheel is `r sum(Professor_trash_wheel$weight_tons, na.rm = TRUE)`. And the total number of cigarette butts collected by Gwynnda in June of 2022 is `r sum(Gwynnda_trash_wheel$cigarette_butts[Gwynnda_trash_wheel$year == 2022 & Gwynnda_trash_wheel$month == "June"], na.rm = TRUE)`.

## Problem 3

```{r message=FALSE}
zip = 
  read_csv("zillow_data/Zip Codes.csv", na = "NA") |> 
  janitor::clean_names() 

price = 
  read_csv("zillow_data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv", na = "NA") |> 
  janitor::clean_names() |> 
  mutate(
    county_name = str_remove(county_name, " County$")
  ) |> 
  rename_with(~str_remove(.x, "^x"), .cols = "x2015_01_31" : "x2024_08_31") |> 
  rename(zip_code = region_name, county = county_name) |> 
  drop_na(`2015_01_31` : `2024_08_31`) |> 
  select(-c(region_type, state_name))

joint_data = 
  right_join(zip, price, by =c("zip_code", "county")) |> 
  pivot_longer(
    `2015_01_31` : `2024_08_31`,
    names_to = "date",
    values_to = "price"
  ) |> 
  select(
    state, city, county, state_fips, county_fips, county_code, metro,      neighborhood, zip_code, region_id, size_rank, date, price,             file_date
  )
  

```

The resulting tidy data is from the zip data left jointed by the price data by both zip code and county name because there are same zip codes in different counties. And I join the dates columns together and make a new variable called dates. The final data consists 14 variables including information of the location, dates, price and file dates.

The final data contains `r nrow(joint_data)` observations and has `r length(unique(joint_data$zip_code))` unique ZIP codes with `r length(unique(joint_data$neighborhood))` unique neighborhoods.

There are `r length(zip$zip_code[!zip$zip_code %in% price$zip_code])` ZIP codes appear in the ZIP code dataset but not in the Zillow Rental Price dataset like: `r as.integer(head(zip$zip_code[!zip$zip_code %in% price$zip_code], 5))`. This may be because some zip place is not availabel for Zillow to collect data and the collecting is not done yet.

```{r}

top10_change = 
  joint_data |> 
  group_by(zip_code)  |> 
  summarise(
    price_max = max(price, na.rm = TRUE),
    price_min = min(price, na.rm = TRUE),
    price_range = price_max - price_min
  ) |> 
  arrange(desc(price_range)) |> 
  slice_head(n = 10) |> 
  left_join(
    (
      zip |> 
        select(zip_code, neighborhood, county)
    ),
    by = "zip_code")

print(top10_change)

```

The table above shows the 10 ZIP codes (along with the borough and neighborhood) with largest drop in price from January 2020 to 2021.
