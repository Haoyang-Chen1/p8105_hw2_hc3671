p8105_hw2_hc3671
================
Barry
2025-09-23

## Problem 1

include packages that will be used:

``` r
library(tidyverse)
library(dplyr)
library(readxl)
library(stringr)
library(readr)
library(tidyr)
```

import and manipulate data.

``` r
pol_df = 
  read_csv("data/pols-month.csv") |> 
  separate(mon, into = c("year", "month", "day"), sep = "-") |> 
  mutate(
    year = as.integer(year),
    month = as.integer(month),   # originally as character
    month = month.name[month],
    president = ifelse(prez_gop == 1, "gop", "dem")
  ) |> 
  select(year, month, president, everything(), -c(day, prez_gop, prez_dem), )

snp_df = 
  read_csv("data/snp.csv") |> 
  separate(date, into = c("month", "day", "year"), sep = "/") |> 
  mutate(
    year = as.integer(paste0("20", year)),
    month = as.integer(month),
    month = month.name[month],
  ) |> 
  select(year, month, everything(), -day) |> 
  arrange(year, month)

unemploy_df = 
  read_csv("data/unemployment.csv") |>
  pivot_longer(
      Jan:Dec,
      names_to = "month",
      values_to = "unemp_per"
  ) |> 
  janitor::clean_names() |> 
  mutate(
    year = as.integer(year),
    month = month.name[match(month, month.abb)]
  )

joint_df = 
  left_join(pol_df, snp_df, by = c("year", "month")) |> 
  left_join(unemploy_df, by = c("year", "month"))
```

Description of the data sets above:  
The `pol_df dataset` contains information about the politicians of the
two parties in the USA, which includes the identity of the party and the
number of different politicians in both parties.The data span from 1947
to 2015, with monthly observations.  
The `snp_df dataset` shows the Standard & Poor’s stock market index
monthly from 2000 to 2099(including prediction).  
The `unemploy_df dataset` reports the monthly unemployment rate in the
United States. The data cover the period from 1948 to 2015. At first,
the value is presented in months. I reshaped them to make sure the
format is compatible with other datasets. The joint_df dataset is the
combination of the three dataset above, which obeys the date information
of the pol_df dataset. Some important values
includes:`yeas`,`month`,`president`,`close rate`,
and`umployment rate`.  

## Problem 2

``` r
Mr_trash_wheel = 
  read_excel("data/202509 Trash Wheel Collection Data.xlsx", sheet = "Mr. Trash Wheel", range = "A2:N709") |> 
  janitor::clean_names() |> 
  mutate(
    sports_balls = as.integer(round(sports_balls)),
    type = "Mr. Trash Wheel",
    year = as.character(year)
   ) |> 
  select(date, everything(), -c(dumpster))

Professor_trash_wheel = 
  read_excel("data/202509 Trash Wheel Collection Data.xlsx", sheet = "Professor Trash Wheel", range = "A2:M134") |> 
  janitor::clean_names() |> 
  mutate(
    type = "Professor Trash Wheel",
    year = as.character(year)
   ) |> 
  select(date, everything(), -c(dumpster))

Gwynns_trash_wheel = 
  read_excel("data/202509 Trash Wheel Collection Data.xlsx", sheet = "Gwynns Falls Trash Wheel", range = "A2:L351") |> 
  janitor::clean_names() |> 
  mutate(
    type = "Gwynns Trash Wheel",
    year = as.character(year)
   ) |> 
  select(date, everything(), -c(dumpster))
  
trash_wheel = 
  bind_rows(Mr_trash_wheel, Professor_trash_wheel, Gwynns_trash_wheel) |> 
  select(date, type, everything()) |> 
  arrange(date)
```

The final dataset has 1188 observations, including three trash
wheels:Mr. Trash Wheel, Professor Trash Wheel, Gwynnda Trash Wheel. Some
key values are dumpster identifier `type`, date `date` and the measure
of different kinds of trash like `weight_tons`, `volume_cubic_yards`,
`plastic_bottles`, `polystyrene`, and `cigarette_butts`.  
More specifically, the total weight of trash collected by Professor
Trash Wheel is 282.26. And the total number of cigarette butts collected
by Gwynnda in June of 2022 is 1.812^{4}.

## Problem 3

``` r
zip = 
  read_csv("zillow_data/Zip Codes.csv", na = "NA") |> 
  janitor::clean_names() 

price = 
  read_csv("zillow_data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv", na = "NA") |> 
  janitor::clean_names() |> 
  mutate(
    county_name = str_remove(county_name, " County$")
  ) |> 
  rename_with(~str_remove(.x, "^x"), .cols = "x2015_01_31" : "x2024_08_31") |> 
  rename(zip_code = region_name, county = county_name) |> 
  filter(
    !if_all(`2015_01_31` : `2024_08_31`, is.na)
    ) |> 
  select(-c(region_type, state_name))

joint_data = 
  right_join(zip, price, by = c("zip_code", "county")) |> 
  pivot_longer(
    `2015_01_31` : `2024_08_31`,
    names_to = "date",
    values_to = "price"
  ) |> 
  select(
    state, city, county, state_fips, county_fips, county_code, metro,      neighborhood, zip_code, region_id, size_rank, date, price,             file_date
  )
```

The resulting tidy data is from the zip data left jointed by the price
data by both zip code and county name because there are same zip codes
in different counties. And I join the dates columns together and make a
new variable called dates. The final data consists 14 variables
including information of the location, dates, price and file dates.

The final data contains 17284 observations and has 149 unique ZIP codes
with 43 unique neighborhoods, but one is a missing value, we are not
sure.

There are 171 ZIP codes appear in the ZIP code dataset but not in the
Zillow Rental Price dataset like: 10464, 10474, 10475, 10499, 10550.
This may be because some zip place is not availabel for Zillow to
collect data and the collecting is not done yet.

The code below shows two types of the price change. One is for the two
months, and the other is the change over this whole period.

``` r
top10_change_jump = 
  right_join(zip, price, by =c("zip_code", "county")) |> 
  mutate(
    change = `2020_01_31` - `2021_01_31`
  ) |> 
  arrange(desc(change)) |> 
  select(zip_code, neighborhood, county, change) |> 
  head(10)
print(top10_change_jump)
```

    ## # A tibble: 10 × 4
    ##    zip_code neighborhood                  county   change
    ##       <dbl> <chr>                         <chr>     <dbl>
    ##  1    10007 Lower Manhattan               New York   913.
    ##  2    10069 <NA>                          New York   748.
    ##  3    10009 Lower East Side               New York   714.
    ##  4    10016 Gramercy Park and Murray Hill New York   712.
    ##  5    10001 Chelsea and Clinton           New York   710.
    ##  6    10002 Lower East Side               New York   710.
    ##  7    10004 Lower Manhattan               New York   706.
    ##  8    10038 Lower Manhattan               New York   698.
    ##  9    10012 Greenwich Village and Soho    New York   686.
    ## 10    10010 Gramercy Park and Murray Hill New York   685.

``` r
top10_change_period = 
  joint_data |> 
  group_by(zip_code)  |> 
  summarise(
    price_max = max(price, na.rm = TRUE),
    price_min = min(price, na.rm = TRUE),
    price_range = price_max - price_min
  ) |> 
  arrange(desc(price_range)) |> 
  slice_head(n = 10) |> 
  left_join(
    (
      zip |> 
        select(zip_code, neighborhood, county)
    ),
    by = "zip_code")

print(top10_change_period)
```

    ## # A tibble: 10 × 6
    ##    zip_code price_max price_min price_range neighborhood               county  
    ##       <dbl>     <dbl>     <dbl>       <dbl> <chr>                      <chr>   
    ##  1    10007     8423.     5422.       3001. Lower Manhattan            New York
    ##  2    10069     5926.     3875.       2051. <NA>                       New York
    ##  3    10013     5740.     3794.       1946. Greenwich Village and Soho New York
    ##  4    10014     5032.     3188.       1844. Greenwich Village and Soho New York
    ##  5    10038     4697.     2876.       1821. Lower Manhattan            New York
    ##  6    10011     5228.     3428.       1800. Chelsea and Clinton        New York
    ##  7    10001     5176.     3378.       1798. Chelsea and Clinton        New York
    ##  8    10004     4224.     2444.       1780. Lower Manhattan            New York
    ##  9    10012     4700.     2942.       1758. Greenwich Village and Soho New York
    ## 10    10282     7074.     5350.       1725. <NA>                       New York

For the change of January 2020 and January 2021, the largest drop of the
rental price is about 913 in Lower Manhattan. And then for the period
change, the largest drop is around 3000 in Lower Manhattan. Both of them
shows that the covid-19 pandemic really has an dramatically influence on
the reantal price.
